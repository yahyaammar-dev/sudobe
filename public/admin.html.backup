<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <title>Admin Panel</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
  <style>
    .sidebar {
      background-color: #f8f9fa;
      min-height: 100vh;
      border-right: 1px solid #dee2e6;
    }

    .sidebar .list-group-item {
      border: none;
      border-radius: 0;
    }

    .sidebar .list-group-item:hover {
      background-color: #e9ecef;
    }

    .sidebar .list-group-item.active {
      background-color: #0d6efd;
      color: white;
    }

    .sidebar .list-group-item a {
      text-decoration: none;
      color: inherit;
      display: block;
      width: 100%;
    }

    .main-content {
      padding: 20px;
    }

    .autocomplete-items {
      border: 1px solid #d4d4d4;
      border-top: none;
      z-index: 99;
      max-height: 200px;
      overflow-y: auto;
    }

    .autocomplete-items div {
      padding: 10px;
      cursor: pointer;
      background-color: #fff;
      border-bottom: 1px solid #d4d4d4;
    }

    .autocomplete-items div:hover {
      background-color: #e9e9e9;
    }

    .table img {
      object-fit: cover;
    }

    .card {
      box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
    }

    .btn-group-sm .btn {
      margin-right: 2px;
    }

    .alert {
      margin-bottom: 20px;
    }

    @media (max-width: 768px) {
      .sidebar {
        min-height: auto;
      }

      .main-content {
        padding: 10px;
      }

      .table-responsive {
        font-size: 0.875rem;
      }
    }
  </style>
</head>

<body>
  <div class="container-fluid">
    <div class="row">
      <!-- Sidebar -->
      <div class="col-md-3 col-lg-2 sidebar p-0">
        <div class="p-3">
          <h4 class="mb-3">SODU CMS</h4>
          <div class="list-group">
            <div class="list-group-item">
              <a href="?section=banners-list">
                <i class="bi bi-inbox"></i> Banners
              </a>
            </div>
            <div class="list-group-item">
              <a href="?section=protections-list">
                <i class="bi bi-shield-check"></i> Protections
              </a>
            </div>
            <div class="list-group-item">
              <a href="?section=images-list" style="width: 100%;">
                <i class="bi bi-image"></i> Images
              </a>
            </div>
          </div>
        </div>
      </div>

      <!-- Main Content -->
      <div class="col-md-9 col-lg-10 main-content">
        <div id="form-container">
          <!-- Content will be dynamically loaded here -->
          <div class="text-center py-5">
            <div class="spinner-border" role="status">
              <span class="visually-hidden">Loading...</span>
            </div>
            <p class="mt-2">Loading...</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Bootstrap JavaScript (Optional, for better UI interactions) -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

  <!-- Your custom admin script -->
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const params = new URLSearchParams(window.location.search);
      const section = params.get('section') || 'banners-list';
      const status = params.get('status');
      const message = params.get('message');

      const formContainer = document.getElementById('form-container');

      if (status && message) {
        const alertType = status === 'success' ? 'success' : 'danger';
        const alertHtml = `
              <div class="alert alert-${alertType} alert-dismissible fade show" role="alert">
                ${decodeURIComponent(message)}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
              </div>
            `;
        formContainer.insertAdjacentHTML('afterbegin', alertHtml);
        window.history.replaceState({}, document.title, window.location.pathname + '?section=' + section);
      }

      // Route to appropriate section
      switch (section) {
        case 'banners-list':
          loadBannerList();
          break;
        case 'banner-form':
          loadBannerForm();
          break;
        case 'banner-edit':
          const bannerId = params.get('id');
          loadBannerEditForm(bannerId);
          break;
        case 'protections-list':
          loadProtectionList();
          break;
        case 'protection':
        case 'protection-form':
          loadProtectionForm();
          break;
        case 'protection-edit':
          const protectionId = params.get('id');
          loadProtectionEditForm(protectionId);
          break;
        case 'banking':
          loadBankingForm();
          break;
        default:
          loadBannerList();
      }

      // Highlight active menu item
      document.querySelectorAll('.sidebar .list-group-item').forEach(item => {
        const link = item.querySelector('a');
        if (link) {
          const href = link.getAttribute('href');
          const currentSection = href.split('section=')[1];
          const activeSection = section.split('-')[0]; // Get base section name

          if (currentSection === section ||
            (currentSection === 'banners-list' && activeSection === 'banner') ||
            (currentSection === 'protections-list' && activeSection === 'protection')) {
            item.classList.add('active');
          } else {
            item.classList.remove('active');
          }
        }
      });

      // === Banner Functions ===
      function loadBannerList() {
        fetch('/api/content/banners')
          .then(res => res.json())
          .then(banners => {
            let html = `
                  <div class="d-flex justify-content-between align-items-center mb-4 gap-3">
                    <h2><i class="bi bi-image me-2"></i>Banner Management</h2>

                    <div class="d-flex justify-content-end align-items-center mb-4 gap-3">
                      <a href="?section=banner-form" class="btn btn-primary">
                        <i class="bi bi-plus-circle me-1"></i>Add New Banner
                      </a>
                        <a href="/api/auth/logout" class="btn btn-primary">
                        <i class="bi bi-arrow-right me-1"></i>Logout
                      </a>
                    </div>
                  </div>
                  <div class="card">
                    <div class="card-body">
                      <div class="table-responsive">
                        <table class="table table-hover">
                          <thead class="table-dark">
                            <tr>
                              <th>ID</th>
                              <th>Type</th>
                              <th>Value</th>
                              <th>Image</th>
                              <th>Priority</th>
                              <th>Actions</th>
                            </tr>
                          </thead>
                          <tbody>
                `;

            if (banners && banners.length > 0) {
              banners.forEach(b => {
                html += `
                      <tr>
                        <td><code>${b.id.substring(0, 8)}...</code></td>
                        <td><span class="badge bg-info">${b.content?.link_type || 'N/A'}</span></td>
                        <td class="text-truncate" style="max-width: 150px;">${b.content?.data_id || 'N/A'}</td>
                        <td>
                          ${b.content?.image?.url ?
                    `<img src="${b.content.image.url}" width="80" height="50" class="img-thumbnail" />` :
                    '<span class="text-muted">No image</span>'
                  }
                        </td>
                        <td class="text-truncate" style="max-width: 150px;">${b.content?.priority || 'N/A'}</td>
                        <td>
                          <div class="btn-group btn-group-sm">
                            <button class="btn btn-outline-warning" onclick="editBanner('${b.id}')" title="Edit">
                              <i class="bi bi-pencil"></i>
                            </button>
                            <button class="btn btn-outline-danger" onclick="deleteBanner('${b.id}')" title="Delete">
                              <i class="bi bi-trash"></i>
                            </button>
                          </div>
                        </td>
                      </tr>
                    `;
              });
            } else {
              html += `
                    <tr>
                      <td colspan="5" class="text-center text-muted py-4">
                        <i class="bi bi-inbox display-1 d-block mb-3"></i>
                        No banners found. <a href="?section=banner-form">Create your first banner</a>
                      </td>
                    </tr>
                  `;
            }

            html += `
                        </tbody>
                      </table>
                    </div>
                  </div>
                </div>
                `;
            formContainer.innerHTML = html;
          })
          .catch(error => {
            console.error('Error loading banners:', error);
            formContainer.innerHTML = `
                  <div class="alert alert-danger">
                    <i class="bi bi-exclamation-triangle me-2"></i>
                    Error loading banners. Please try again.
                  </div>
                `;
          });
      }

      function loadBannerForm(editData = null) {
        const isEdit = editData !== null;
        const title = isEdit ? 'Edit Banner' : 'Create New Banner';
        const submitText = isEdit ? 'Save Banner' : 'Create Banner';

        formContainer.innerHTML = `
              <div class="d-flex justify-content-between align-items-center mb-4">
                <h2><i class="bi bi-${isEdit ? 'pencil' : 'plus-circle'} me-2"></i>${title}</h2>
                <a href="?section=banners-list" class="btn btn-outline-secondary">
                  <i class="bi bi-arrow-left me-1"></i>Back to List
                </a>
              </div>
              <div class="card">
                <div class="card-header">
                  <h5 class="card-title mb-0">${title}</h5>
                </div>
                <div class="card-body">
                  <form id="bannerForm" enctype="multipart/form-data">
                    <div class="mb-3">
                      <label class="form-label">Banner Type <span class="text-danger">*</span></label>
                      <select name="bannerType" id="bannerType" class="form-select" required>
                        <option value="">-- Select Type --</option>
                        <option value="category" ${editData?.content?.link_type === 'category' ? 'selected' : ''}>Category</option>
                        <option value="product" ${editData?.content?.link_type === 'product' ? 'selected' : ''}>Product</option>
                        <option value="factory" ${editData?.content?.link_type === 'factory' ? 'selected' : ''}>Factory</option>
                      </select>
                    </div>
                    <div class="mb-3" id="valueContainer"></div>
                    <div class="mb-3">
                      <label class="form-label">Banner Image ${isEdit ? '' : '<span class="text-danger">*</span>'}</label>
                      <input type="file" name="bannerImage" id="bannerImage" class="form-control" accept="image/*" ${isEdit ? '' : 'required'} />
                      ${editData?.content?.image?.url ?
            `<div class="mt-3">
                          <label class="form-label text-muted">Current Image:</label><br>
                          <img src="${editData.content.image.url}" width="200" class="img-thumbnail" />
                        </div>` : ''
          }
                      ${isEdit ? '<small class="form-text text-muted">Leave empty to keep current image</small>' : ''}
                    </div>

<div class="mb-3">
  <label for="priority" class="form-label">Priority <span class="text-danger">*</span></label>
  <input
    type="number"
    class="form-control"
    id="priority"
    name="priority"
    required
    value="${isEdit && editData?.content?.priority ? editData.content.priority : ''}"
  />
</div>
                    <div class="d-flex gap-2">
                      <button type="submit" class="btn btn-primary">
                        <i class="bi bi-${isEdit ? 'check-circle' : 'plus-circle'} me-1"></i>${submitText}
                      </button>
                      <a href="?section=banners-list" class="btn btn-secondary">
                        <i class="bi bi-x-circle me-1"></i>Cancel
                      </a>
                    </div>
                  </form>
                </div>
              </div>
            `;

        // Handle form submission
        document.getElementById('bannerForm').addEventListener('submit', async (e) => {
          e.preventDefault();
          const formData = new FormData(e.target);
          const submitBtn = e.target.querySelector('button[type="submit"]');
          const originalText = submitBtn.innerHTML;
          formData.append("priority", document.getElementById("priority").value);

          submitBtn.innerHTML = '<span class="spinner-border spinner-border-sm me-1"></span>Saving...';
          submitBtn.disabled = true;

          try {
            let response;
            if (isEdit) {
              response = await fetch(`/api/content/banners/${editData.id}`, {
                method: 'PUT',
                body: formData
              });
            } else {
              response = await fetch('/api/content', {
                method: 'POST',
                body: formData
              });
            }

            if (response.ok) {
              window.location.href = '?section=banners-list&status=success&message=' +
                encodeURIComponent(`Banner ${isEdit ? 'updated' : 'created'} successfully`);
            } else {
              throw new Error('Server error');
            }
          } catch (error) {
            console.error('Error:', error);
            alert('Error saving banner. Please try again.');
            submitBtn.innerHTML = originalText;
            submitBtn.disabled = false;
          }
        });

        // Setup banner type change handler
        setupBannerTypeHandler(editData);
      }

      function loadBannerEditForm(bannerId) {
        formContainer.innerHTML = `
              <div class="text-center py-5">
                <div class="spinner-border" role="status"></div>
                <p class="mt-2">Loading banner details...</p>
              </div>
            `;

        fetch(`/api/content/banners`)
          .then(res => res.json())
          .then(banners => {
            const banner = banners.find(b => b.id === bannerId);
            if (banner) {
              loadBannerForm(banner);
            } else {
              formContainer.innerHTML = `
                    <div class="alert alert-danger">
                      <i class="bi bi-exclamation-triangle me-2"></i>
                      Banner not found
                    </div>
                  `;
            }
          })
          .catch(error => {
            console.error('Error loading banner:', error);
            formContainer.innerHTML = `
                  <div class="alert alert-danger">
                    <i class="bi bi-exclamation-triangle me-2"></i>
                    Error loading banner
                  </div>
                `;
          });
      }

      function setupBannerTypeHandler(editData = null) {
        document.getElementById('bannerType').addEventListener('change', async (e) => {
          const type = e.target.value;
          const container = document.getElementById('valueContainer');
          container.innerHTML = '<div class="text-center"><div class="spinner-border spinner-border-sm"></div> Loading options...</div>';

          try {
            let html = '';
            if (type === 'category') {
              const res = await fetch('/api/content/categories');
              const categories = await res.json();
              html += `<label class="form-label">Select Category <span class="text-danger">*</span></label>
                           <select name="bannerValue" class="form-select" required>`;
              html += `<option value="">-- Select Category --</option>`;
              categories.forEach(c => {
                const selected = editData?.content?.data_id === c.id ? 'selected' : '';
                html += `<option value="${c.id}" ${selected}>${c.name}</option>`;
              });
              html += `</select>`;
            } else if (type === 'factory') {
              const res = await fetch('/api/content/factories');
              const factories = await res.json();
              html += `<label class="form-label">Select Factory <span class="text-danger">*</span></label>
                           <select name="bannerValue" class="form-select" required>`;
              html += `<option value="">-- Select Factory --</option>`;
              factories.forEach(f => {
                const selected = editData?.content?.data_id === f.id ? 'selected' : '';
                html += `<option value="${f.id}" ${selected}>${f.content?.factory_name || f.name || 'Unnamed Factory'}</option>`;
              });
              html += `</select>`;
            } else if (type === 'product') {
              html = `
                    <label class="form-label">Search Product <span class="text-danger">*</span></label>
                    <div class="autocomplete position-relative">
                      <input type="text" id="bannerValueInput" class="form-control" placeholder="Type to search for product..." autocomplete="off">
                      <input type="hidden" name="bannerValue" id="bannerValue" required />
                      <div id="productAutocomplete" class="autocomplete-items position-absolute w-100 bg-white border rounded" style="z-index: 1000; max-height: 200px; overflow-y: auto; display: none;"></div>
                    </div>
                  `;
            }

            container.innerHTML = html;

            // Product autocomplete
            if (type === 'product') {
              setupProductAutocomplete(editData);
            }

          } catch (error) {
            console.error('Error loading options', error);
            container.innerHTML = `
                  <div class="alert alert-danger">
                    <i class="bi bi-exclamation-triangle me-2"></i>
                    Error loading options. Please try again.
                  </div>
                `;
          }
        });

        // Trigger change event if editing
        if (editData && editData.content?.link_type) {
          document.getElementById('bannerType').dispatchEvent(new Event('change'));
        }
      }

      function setupProductAutocomplete(editData = null) {
        const input = document.getElementById('bannerValueInput');
        const hiddenInput = document.getElementById('bannerValue');
        const autocomplete = document.getElementById('productAutocomplete');

        // Set initial value if editing
        if (editData?.content?.data_id) {
          hiddenInput.value = editData.content.data_id;
          // Fetch product name for display
          fetch(`/api/content/products?search=`)
            .then(res => res.json())
            .then(products => {
              const product = products.find(p => p.id === editData.content.data_id);
              if (product) {
                input.value = product.name;
              }
            });
        }

        input.addEventListener('input', async function () {
          const term = this.value;
          if (term.length < 2) {
            autocomplete.style.display = 'none';
            autocomplete.innerHTML = '';
            return;
          }

          try {
            const res = await fetch(`/api/content/products?search=${encodeURIComponent(term)}`);
            const products = await res.json();

            autocomplete.innerHTML = '';
            if (products.length > 0) {
              products.forEach(product => {
                const item = document.createElement('div');
                item.classList.add('p-3', 'border-bottom');
                item.style.cursor = 'pointer';
                item.innerHTML = `
                      <div><strong>${product.name}</strong></div>
                      <small class="text-muted">SKU: ${product.sku || 'N/A'}</small>
                    `;
                item.addEventListener('click', () => {
                  input.value = product.name;
                  hiddenInput.value = product.id;
                  autocomplete.style.display = 'none';
                });
                item.addEventListener('mouseenter', () => item.classList.add('bg-light'));
                item.addEventListener('mouseleave', () => item.classList.remove('bg-light'));
                autocomplete.appendChild(item);
              });
              autocomplete.style.display = 'block';
            } else {
              autocomplete.innerHTML = '<div class="p-3 text-muted">No products found</div>';
              autocomplete.style.display = 'block';
            }
          } catch (error) {
            console.error('Error fetching products:', error);
            autocomplete.innerHTML = '<div class="p-3 text-danger">Error loading products</div>';
            autocomplete.style.display = 'block';
          }
        });

        // Close autocomplete when clicking outside
        document.addEventListener('click', (e) => {
          if (!input.contains(e.target) && !autocomplete.contains(e.target)) {
            autocomplete.style.display = 'none';
          }
        });
      }

      // === Protection Functions ===
      function loadProtectionList() {
        fetch('/api/content/protections')
          .then(res => res.json())
          .then(protections => {
            let html = `
                  <div class="d-flex justify-content-between align-items-center mb-4">
                    <h2><i class="bi bi-shield-check me-2"></i>Protection Management</h2>
                    <a href="?section=protection-form" class="btn btn-primary">
                      <i class="bi bi-plus-circle me-1"></i>Add New Protection
                    </a>
                  </div>
                  <div class="card">
                    <div class="card-body">
                      <div class="table-responsive">
                        <table class="table table-hover">
                          <thead class="table-dark">
                            <tr>
                              <th>ID</th>
                              <th>Title</th>
                              <th>Short Description</th>
                              <th>Icon</th>
                              <th>Actions</th>
                            </tr>
                          </thead>
                          <tbody>
                `;

            if (protections && protections.length > 0) {
              protections.forEach(p => {
                html += `
                      <tr>
                        <td><code>${p.id.substring(0, 8)}...</code></td>
                        <td><strong>${p.content?.title || 'N/A'}</strong></td>
                        <td class="text-truncate" style="max-width: 200px;">${p.content?.short_description || 'N/A'}</td>
                        <td>
                          ${p.content?.icon?.url ?
                    `<img src="${p.content.icon.url}" width="40" height="40" class="img-thumbnail"/>` :
                    '<span class="text-muted">No icon</span>'
                  }
                        </td>
                        <td>
                          <div class="btn-group btn-group-sm">
                            <button class="btn btn-outline-warning" onclick="editProtection('${p.id}')" title="Edit">
                              <i class="bi bi-pencil"></i>
                            </button>
                            <button class="btn btn-outline-danger" onclick="deleteProtection('${p.id}')" title="Delete">
                              <i class="bi bi-trash"></i>
                            </button>
                          </div>
                        </td>
                      </tr>
                    `;
              });
            } else {
              html += `
                    <tr>
                      <td colspan="5" class="text-center text-muted py-4">
                        <i class="bi bi-shield-x display-1 d-block mb-3"></i>
                        No protections found. <a href="?section=protection-form">Create your first protection</a>
                      </td>
                    </tr>
                  `;
            }

            html += `
                        </tbody>
                      </table>
                    </div>
                  </div>
                </div>
                `;
            formContainer.innerHTML = html;
          })
          .catch(error => {
            console.error('Error loading protections:', error);
            formContainer.innerHTML = `
                  <div class="alert alert-danger">
                    <i class="bi bi-exclamation-triangle me-2"></i>
                    Error loading protections. Please try again.
                  </div>
                `;
          });
      }

      function loadProtectionForm(editData = null) {
        const isEdit = editData !== null;
        const title = isEdit ? 'Edit Protection' : 'Create New Protection';
        const submitText = isEdit ? 'Save Protection' : 'Create Protection';

        formContainer.innerHTML = `
              <div class="d-flex justify-content-between align-items-center mb-4">
                <h2><i class="bi bi-${isEdit ? 'pencil' : 'plus-circle'} me-2"></i>${title}</h2>
                <a href="?section=protections-list" class="btn btn-outline-secondary">
                  <i class="bi bi-arrow-left me-1"></i>Back to List
                </a>
              </div>
              <div class="card">
                <div class="card-header">
                  <h5 class="card-title mb-0">${title}</h5>
                </div>
                <div class="card-body">
                  <form id="protectionForm" enctype="multipart/form-data">
                    <div class="mb-3">
                      <label class="form-label">Protection Icon ${isEdit ? '' : '<span class="text-danger">*</span>'}</label>
                      <input type="file" name="proctectionIcon" id="protectionIcon" class="form-control" accept="image/*" ${isEdit ? '' : 'required'} />
                      ${editData?.content?.icon?.url ?
            `<div class="mt-3">
                          <label class="form-label text-muted">Current Icon:</label><br>
                          <img src="${editData.content.icon.url}" width="80" class="img-thumbnail" />
                        </div>` : ''
          }
                      ${isEdit ? '<small class="form-text text-muted">Leave empty to keep current icon</small>' : ''}
                    </div>
                    <div class="mb-3">
                      <label class="form-label">Title <span class="text-danger">*</span></label>
                      <input type="text" name="title" class="form-control" value="${editData?.content?.title || ''}" required placeholder="Enter protection title" />
                    </div>
                    <div class="mb-3">
                      <label class="form-label">Short Description <span class="text-danger">*</span></label>
                      <input type="text" name="short_description" class="form-control" value="${editData?.content?.short_description || ''}" required placeholder="Brief description" />
                    </div>
                    <div class="mb-3">
                      <label class="form-label">Long Description <span class="text-danger">*</span></label>
                      <textarea name="long_description" class="form-control" rows="4" required placeholder="Detailed description">${editData?.content?.long_description || ''}</textarea>
                    </div>
                    <div class="d-flex gap-2">
                      <button type="submit" class="btn btn-primary">
                        <i class="bi bi-${isEdit ? 'check-circle' : 'plus-circle'} me-1"></i>${submitText}
                      </button>
                      <a href="?section=protections-list" class="btn btn-secondary">
                        <i class="bi bi-x-circle me-1"></i>Cancel
                      </a>
                    </div>
                  </form>
                </div>
              </div>
            `;

        // Handle form submission
        document.getElementById('protectionForm').addEventListener('submit', async (e) => {
          e.preventDefault();
          const formData = new FormData(e.target);
          const submitBtn = e.target.querySelector('button[type="submit"]');
          const originalText = submitBtn.innerHTML;

          submitBtn.innerHTML = '<span class="spinner-border spinner-border-sm me-1"></span>Saving...';
          submitBtn.disabled = true;

          try {
            let response;
            if (isEdit) {
              response = await fetch(`/api/content/protections/${editData.id}`, {
                method: 'PUT',
                body: formData
              });
            } else {
              response = await fetch('/api/content/protection', {
                method: 'POST',
                body: formData
              });
            }

            if (response.ok) {
              window.location.href = '?section=protections-list&status=success&message=' +
                encodeURIComponent(`Protection ${isEdit ? 'updated' : 'created'} successfully`);
            } else {
              throw new Error('Server error');
            }
          } catch (error) {
            console.error('Error:', error);
            alert('Error saving protection. Please try again.');
            submitBtn.innerHTML = originalText;
            submitBtn.disabled = false;
          }
        });
      }

      function loadProtectionEditForm(protectionId) {
        formContainer.innerHTML = `
              <div class="text-center py-5">
                <div class="spinner-border" role="status"></div>
                <p class="mt-2">Loading protection details...</p>
              </div>
            `;

        fetch(`/api/content/protections`)
          .then(res => res.json())
          .then(protections => {
            const protection = protections.find(p => p.id === protectionId);
            if (protection) {
              loadProtectionForm(protection);
            } else {
              formContainer.innerHTML = `
                    <div class="alert alert-danger">
                      <i class="bi bi-exclamation-triangle me-2"></i>
                      Protection not found
                    </div>
                  `;
            }
          })
          .catch(error => {
            console.error('Error loading protection:', error);
            formContainer.innerHTML = `
                  <div class="alert alert-danger">
                    <i class="bi bi-exclamation-triangle me-2"></i>
                    Error loading protection
                  </div>
                `;
          });
      }

      // === Banking Form ===
      function loadBankingForm() {
        formContainer.innerHTML = `
              <div class="mb-4">
                <h2><i class="bi bi-bank me-2"></i>Banking Details</h2>
              </div>
              <div class="card">
                <div class="card-header">
                  <h5 class="card-title mb-0">Update Banking Information</h5>
                </div>
                <div class="card-body">
                  <form action="/api/content/banking" method="POST">
                    <div class="row">
                      <div class="col-md-6 mb-3">
                        <label class="form-label">Account Number <span class="text-danger">*</span></label>
                        <input type="text" name="accountNumber" class="form-control" required placeholder="Enter account number" />
                      </div>
                      <div class="col-md-6 mb-3">
                        <label class="form-label">SWIFT Code <span class="text-danger">*</span></label>
                        <input type="text" name="swiftCode" class="form-control" required placeholder="Enter SWIFT code" />
                      </div>
                    </div>
                    <div class="mb-3">
                      <label class="form-label">Beneficiary Name <span class="text-danger">*</span></label>
                      <input type="text" name="beneficiaryName" class="form-control" required placeholder="Enter beneficiary name" />
                    </div>
                    <div class="mb-3">
                      <label class="form-label">Beneficiary Address <span class="text-danger">*</span></label>
                      <textarea name="beneficiaryAddress" class="form-control" rows="3" required placeholder="Enter beneficiary address"></textarea>
                    </div>
                    <div class="mb-3">
                      <label class="form-label">Beneficiary Bank <span class="text-danger">*</span></label>
                      <input type="text" name="beneficiaryBank" class="form-control" required placeholder="Enter beneficiary bank name" />
                    </div>
                    <div class="mb-3">
                      <label class="form-label">Beneficiary Bank Address <span class="text-danger">*</span></label>
                      <textarea name="beneficiaryBankAddress" class="form-control" rows="3" required placeholder="Enter beneficiary bank address"></textarea>
                    </div>
                    <button type="submit" class="btn btn-primary">
                      <i class="bi bi-check-circle me-1"></i>Submit Banking Details
                    </button>
                  </form>
                </div>
              </div>
            `;
      }

      // === Global Functions (attached to window for onclick handlers) ===
      window.editBanner = function (id) {
        window.location.href = `?section=banner-edit&id=${id}`;
      };

      window.deleteBanner = function (id) {
        if (!confirm('Are you sure you want to delete this banner? This action cannot be undone.')) return;

        const btn = event.target.closest('button');
        const originalHtml = btn.innerHTML;
        btn.innerHTML = '<span class="spinner-border spinner-border-sm"></span>';
        btn.disabled = true;

        fetch(`/api/content/banners/${id}`, { method: 'DELETE' })
          .then(response => {
            if (response.ok) {
              loadBannerList();
              // Show success message
              const alertHtml = `
                    <div class="alert alert-success alert-dismissible fade show" role="alert">
                      <i class="bi bi-check-circle me-2"></i>
                      Banner deleted successfully
                      <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                    </div>
                  `;
              formContainer.insertAdjacentHTML('afterbegin', alertHtml);
            } else {
              throw new Error('Server error');
            }
          })
          .catch(error => {
            console.error('Error:', error);
            alert('Error deleting banner. Please try again.');
            btn.innerHTML = originalHtml;
            btn.disabled = false;
          });
      };

      window.editProtection = function (id) {
        window.location.href = `?section=protection-edit&id=${id}`;
      };

      window.deleteProtection = function (id) {
        if (!confirm('Are you sure you want to delete this protection? This action cannot be undone.')) return;

        const btn = event.target.closest('button');
        const originalHtml = btn.innerHTML;
        btn.innerHTML = '<span class="spinner-border spinner-border-sm"></span>';
        btn.disabled = true;

        fetch(`/api/content/protections/${id}`, { method: 'DELETE' })
          .then(response => {
            if (response.ok) {
              loadProtectionList();
              // Show success message
              const alertHtml = `
                    <div class="alert alert-success alert-dismissible fade show" role="alert">
                      <i class="bi bi-check-circle me-2"></i>
                      Protection deleted successfully
                      <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                    </div>
                  `;
              formContainer.insertAdjacentHTML('afterbegin', alertHtml);
            } else {
              throw new Error('Server error');
            }
          })
          .catch(error => {
            console.error('Error:', error);
            alert('Error deleting protection. Please try again.');
            btn.innerHTML = originalHtml;
            btn.disabled = false;
          });
      };
    });
  </script>
</body>

</html>